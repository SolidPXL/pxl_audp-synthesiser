#include "effects.h"

void distortion (void* config) {
	struct sine_generator_config parsed_config = *((struct sine_generator_config*)(config));
	struct distortion_config parsed_config = *((struct distortion_config*)(config));

	    for (int i = 0; i < MAINBUFFER_SIZE; i++) {

	        float32_t in = (float32_t)g_sound_buffer[i] / (float32_t)INT32_MAX;

	        in = in * parsed_config.gain;

	        if (in > parsed_config.threshold)      in = parsed_config.threshold;
	        else if (in < - parsed_config.threshold) in = - parsed_config.threshold;

	        g_sound_buffer[i] = (int32_t)(in * (float32_t)INT32_MAX);
	    }
}
